from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Conv2D, MaxPooling2D, Flatten, Dense
from tensorflow.keras.preprocessing.image import ImageDataGenerator

# Simple CNN architecture
model = Sequential([
    Conv2D(32, (3,3), activation="relu", input_shape=(128,128,3)),
    MaxPooling2D(pool_size=(2,2)),
    Flatten(),
    Dense(64, activation="relu"),
    Dense(1, activation="sigmoid")  # binary classification: healthy vs diseased
])

model.compile(optimizer="adam", loss="binary_crossentropy", metrics=["accuracy"])

# Example: training with image generator (replace with real dataset)
datagen = ImageDataGenerator(rescale=1./255)
train_data = datagen.flow_from_directory("datasets/crop_images", target_size=(128,128), batch_size=32, class_mode="binary")

model.fit(train_data, epochs=5)

# Save model
model.save("backend/models_store/crop_health_cnn.h5")
print("Crop health CNN saved to models_store/crop_health_cnn.h5")
from tensorflow.keras.models import load_model
cnn_model = load_model("backend/models_store/crop_health_cnn.h5")
prediction = cnn_model.predict(image_array)
